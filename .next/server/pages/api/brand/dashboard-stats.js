"use strict";(()=>{var exports={};exports.id="pages/api/brand/dashboard-stats",exports.ids=["pages/api/brand/dashboard-stats"],exports.modules={"@prisma/client/edge":n=>{n.exports=require("@prisma/client/edge")},bcryptjs:n=>{n.exports=require("bcryptjs")},jsonwebtoken:n=>{n.exports=require("jsonwebtoken")},"next/dist/compiled/next-server/pages-api.runtime.dev.js":n=>{n.exports=require("next/dist/compiled/next-server/pages-api.runtime.dev.js")},"@prisma/extension-accelerate":n=>{n.exports=import("@prisma/extension-accelerate")},"(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbrand%2Fdashboard-stats&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cbrand%5Cdashboard-stats.ts&middlewareConfigBase64=e30%3D!":(module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ "(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ "(api)/./node_modules/next/dist/server/future/route-kind.js");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ "(api)/./node_modules/next/dist/build/templates/helpers.js");\n/* harmony import */ var _src_pages_api_brand_dashboard_stats_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\brand\\dashboard-stats.ts */ "(api)/./src/pages/api/brand/dashboard-stats.ts");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_brand_dashboard_stats_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_brand_dashboard_stats_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_brand_dashboard_stats_ts__WEBPACK_IMPORTED_MODULE_3__, "default"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_brand_dashboard_stats_ts__WEBPACK_IMPORTED_MODULE_3__, "config");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: "/api/brand/dashboard-stats",\n        pathname: "/api/brand/dashboard-stats",\n        // The following aren\'t used in production.\n        bundlePath: "",\n        filename: ""\n    },\n    userland: _src_pages_api_brand_dashboard_stats_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmJyYW5kJTJGZGFzaGJvYXJkLXN0YXRzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTVDcGFnZXMlNUNhcGklNUNicmFuZCU1Q2Rhc2hib2FyZC1zdGF0cy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUN5RTtBQUN6RTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsb0VBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG9FQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL25leHQtcGFnZXMtY2hha3JhLz8yYTA1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9zcmNcXFxccGFnZXNcXFxcYXBpXFxcXGJyYW5kXFxcXGRhc2hib2FyZC1zdGF0cy50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2JyYW5kL2Rhc2hib2FyZC1zdGF0c1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2JyYW5kL2Rhc2hib2FyZC1zdGF0c1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbrand%2Fdashboard-stats&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cbrand%5Cdashboard-stats.ts&middlewareConfigBase64=e30%3D!\n')},"(api)/./src/lib/auth.ts":(module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   getUserFromRequest: () => (/* binding */ getUserFromRequest),\n/* harmony export */   getUserFromToken: () => (/* binding */ getUserFromToken),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   verifyAuth: () => (/* binding */ verifyAuth),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken),\n/* harmony export */   verifyTokenString: () => (/* binding */ verifyTokenString),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withAuthAndRole: () => (/* binding */ withAuthAndRole)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ "(api)/./src/lib/prisma.ts");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ "jsonwebtoken");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! bcryptjs */ "bcryptjs");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_prisma__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || "your-secret-key-change-in-production";\n// Hash password\nasync function hashPassword(password) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_2___default().hash(password, 12);\n}\n// Verify password\nasync function verifyPassword(password, hashedPassword) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_2___default().compare(password, hashedPassword);\n}\n// Generate JWT token\nfunction generateToken(user) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign({\n        user\n    }, JWT_SECRET, {\n        expiresIn: "7d"\n    });\n}\n// Verify JWT token (string version)\nfunction verifyTokenString(token) {\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n        // Handle both old and new token formats\n        if (decoded.user) {\n            return decoded;\n        } else if (decoded.userId) {\n            // Convert old format to new format\n            return {\n                user: {\n                    id: decoded.userId,\n                    email: decoded.email || "",\n                    name: decoded.name || "",\n                    role: decoded.role || "CUSTOMER"\n                },\n                iat: decoded.iat,\n                exp: decoded.exp\n            };\n        }\n        return null;\n    } catch (error) {\n        console.error("Token verification error:", error);\n        return null;\n    }\n}\n// Get user from token\nasync function getUserFromToken(token) {\n    const decoded = verifyTokenString(token);\n    if (!decoded) return null;\n    try {\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n            where: {\n                id: decoded.user.id\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n                role: true\n            }\n        });\n        return user;\n    } catch (error) {\n        console.error("Error fetching user from token:", error);\n        return null;\n    }\n}\n// Enhanced verifyToken function for API requests\nasync function verifyToken(req) {\n    try {\n        // Try to get token from Authorization header first, then from cookies\n        let token = req.headers.authorization?.replace("Bearer ", "");\n        if (!token && req.cookies.token) {\n            token = req.cookies.token;\n        }\n        if (!token) {\n            return null;\n        }\n        // Verify and decode token\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n        let userId;\n        // Handle both token formats\n        if (decoded.user?.id) {\n            userId = decoded.user.id;\n        } else if (decoded.userId) {\n            userId = decoded.userId;\n        } else {\n            return null;\n        }\n        // Fetch fresh user data from database\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n            where: {\n                id: userId\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n                role: true\n            }\n        });\n        return user;\n    } catch (error) {\n        console.error("Token verification error:", error);\n        return null;\n    }\n}\n// Middleware to protect API routes\nfunction withAuth(handler) {\n    return async (req, res)=>{\n        try {\n            // Try to get token from Authorization header first, then from cookies\n            let token = req.headers.authorization?.replace("Bearer ", "");\n            if (!token && req.cookies.token) {\n                token = req.cookies.token;\n            }\n            console.log("Auth middleware - Token present:", !!token);\n            console.log("Auth middleware - Headers:", req.headers.authorization ? "Authorization header present" : "No authorization header");\n            console.log("Auth middleware - Cookies:", req.cookies.token ? "Token cookie present" : "No token cookie");\n            if (!token) {\n                console.log("Auth middleware - No token provided");\n                return res.status(401).json({\n                    error: "No token provided"\n                });\n            }\n            const user = await getUserFromToken(token);\n            if (!user) {\n                console.log("Auth middleware - Invalid token");\n                return res.status(401).json({\n                    error: "Invalid token"\n                });\n            }\n            console.log("Auth middleware - User authenticated:", user.email, user.role);\n            return handler(req, res, user);\n        } catch (error) {\n            console.error("Auth middleware error:", error);\n            return res.status(500).json({\n                error: "Authentication error"\n            });\n        }\n    };\n}\n// Middleware to protect API routes with role check\nfunction withAuthAndRole(roles, handler) {\n    return withAuth(async (req, res, user)=>{\n        if (!roles.includes(user.role)) {\n            return res.status(403).json({\n                error: "Insufficient permissions"\n            });\n        }\n        return handler(req, res, user);\n    });\n}\n// Get user from request (for pages)\nasync function getUserFromRequest(req) {\n    const token = req.headers.authorization?.replace("Bearer ", "") || req.cookies.token;\n    if (!token) return null;\n    return getUserFromToken(token);\n}\n// Verify auth for API routes with proper result format\nasync function verifyAuth(req) {\n    try {\n        const user = await verifyToken(req);\n        if (user) {\n            return {\n                success: true,\n                user\n            };\n        } else {\n            return {\n                success: false,\n                error: "Authentication failed"\n            };\n        }\n    } catch (error) {\n        console.error("Auth verification error:", error);\n        return {\n            success: false,\n            error: "Authentication error"\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dC1wYWdlcy1jaGFrcmEvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XHJcbmltcG9ydCB7IFVzZXJSb2xlIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xyXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XHJcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnO1xyXG5cclxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleS1jaGFuZ2UtaW4tcHJvZHVjdGlvbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhVc2VyIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIHJvbGU6IFVzZXJSb2xlO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhUb2tlbiB7XHJcbiAgdXNlcjogQXV0aFVzZXI7XHJcbiAgaWF0OiBudW1iZXI7XHJcbiAgZXhwOiBudW1iZXI7XHJcbn1cclxuXHJcbi8vIEhhc2ggcGFzc3dvcmRcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc2hQYXNzd29yZChwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICByZXR1cm4gYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEyKTtcclxufVxyXG5cclxuLy8gVmVyaWZ5IHBhc3N3b3JkXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZChwYXNzd29yZDogc3RyaW5nLCBoYXNoZWRQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgcmV0dXJuIGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCBoYXNoZWRQYXNzd29yZCk7XHJcbn1cclxuXHJcbi8vIEdlbmVyYXRlIEpXVCB0b2tlblxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbih1c2VyOiBBdXRoVXNlcik6IHN0cmluZyB7XHJcbiAgcmV0dXJuIGp3dC5zaWduKFxyXG4gICAgeyB1c2VyIH0sXHJcbiAgICBKV1RfU0VDUkVULFxyXG4gICAgeyBleHBpcmVzSW46ICc3ZCcgfVxyXG4gICk7XHJcbn1cclxuXHJcbi8vIFZlcmlmeSBKV1QgdG9rZW4gKHN0cmluZyB2ZXJzaW9uKVxyXG5leHBvcnQgZnVuY3Rpb24gdmVyaWZ5VG9rZW5TdHJpbmcodG9rZW46IHN0cmluZyk6IEF1dGhUb2tlbiB8IG51bGwge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCkgYXMgYW55O1xyXG4gICAgXHJcbiAgICAvLyBIYW5kbGUgYm90aCBvbGQgYW5kIG5ldyB0b2tlbiBmb3JtYXRzXHJcbiAgICBpZiAoZGVjb2RlZC51c2VyKSB7XHJcbiAgICAgIHJldHVybiBkZWNvZGVkIGFzIEF1dGhUb2tlbjtcclxuICAgIH0gZWxzZSBpZiAoZGVjb2RlZC51c2VySWQpIHtcclxuICAgICAgLy8gQ29udmVydCBvbGQgZm9ybWF0IHRvIG5ldyBmb3JtYXRcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICBpZDogZGVjb2RlZC51c2VySWQsXHJcbiAgICAgICAgICBlbWFpbDogZGVjb2RlZC5lbWFpbCB8fCAnJyxcclxuICAgICAgICAgIG5hbWU6IGRlY29kZWQubmFtZSB8fCAnJyxcclxuICAgICAgICAgIHJvbGU6IGRlY29kZWQucm9sZSB8fCAnQ1VTVE9NRVInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpYXQ6IGRlY29kZWQuaWF0LFxyXG4gICAgICAgIGV4cDogZGVjb2RlZC5leHBcclxuICAgICAgfSBhcyBBdXRoVG9rZW47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdUb2tlbiB2ZXJpZmljYXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBHZXQgdXNlciBmcm9tIHRva2VuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyRnJvbVRva2VuKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPEF1dGhVc2VyIHwgbnVsbD4ge1xyXG4gIGNvbnN0IGRlY29kZWQgPSB2ZXJpZnlUb2tlblN0cmluZyh0b2tlbik7XHJcbiAgaWYgKCFkZWNvZGVkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGRlY29kZWQudXNlci5pZCB9LFxyXG4gICAgICBzZWxlY3Q6IHtcclxuICAgICAgICBpZDogdHJ1ZSxcclxuICAgICAgICBlbWFpbDogdHJ1ZSxcclxuICAgICAgICBuYW1lOiB0cnVlLFxyXG4gICAgICAgIHJvbGU6IHRydWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdXNlcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciBmcm9tIHRva2VuOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRW5oYW5jZWQgdmVyaWZ5VG9rZW4gZnVuY3Rpb24gZm9yIEFQSSByZXF1ZXN0c1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VG9rZW4ocmVxOiBOZXh0QXBpUmVxdWVzdCk6IFByb21pc2U8QXV0aFVzZXIgfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFRyeSB0byBnZXQgdG9rZW4gZnJvbSBBdXRob3JpemF0aW9uIGhlYWRlciBmaXJzdCwgdGhlbiBmcm9tIGNvb2tpZXNcclxuICAgIGxldCB0b2tlbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24/LnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XHJcbiAgICBcclxuICAgIGlmICghdG9rZW4gJiYgcmVxLmNvb2tpZXMudG9rZW4pIHtcclxuICAgICAgdG9rZW4gPSByZXEuY29va2llcy50b2tlbjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKCF0b2tlbikge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZnkgYW5kIGRlY29kZSB0b2tlblxyXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIEpXVF9TRUNSRVQpIGFzIGFueTtcclxuICAgIGxldCB1c2VySWQ6IHN0cmluZztcclxuICAgIFxyXG4gICAgLy8gSGFuZGxlIGJvdGggdG9rZW4gZm9ybWF0c1xyXG4gICAgaWYgKGRlY29kZWQudXNlcj8uaWQpIHtcclxuICAgICAgdXNlcklkID0gZGVjb2RlZC51c2VyLmlkO1xyXG4gICAgfSBlbHNlIGlmIChkZWNvZGVkLnVzZXJJZCkge1xyXG4gICAgICB1c2VySWQgPSBkZWNvZGVkLnVzZXJJZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZldGNoIGZyZXNoIHVzZXIgZGF0YSBmcm9tIGRhdGFiYXNlXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcclxuICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgZW1haWw6IHRydWUsXHJcbiAgICAgICAgbmFtZTogdHJ1ZSxcclxuICAgICAgICByb2xlOiB0cnVlLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHVzZXI7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHZlcmlmaWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vIE1pZGRsZXdhcmUgdG8gcHJvdGVjdCBBUEkgcm91dGVzXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoQXV0aChoYW5kbGVyOiAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UsIHVzZXI6IEF1dGhVc2VyKSA9PiBQcm9taXNlPHZvaWQ+KSB7XHJcbiAgcmV0dXJuIGFzeW5jIChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVHJ5IHRvIGdldCB0b2tlbiBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyIGZpcnN0LCB0aGVuIGZyb20gY29va2llc1xyXG4gICAgICBsZXQgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5yZXBsYWNlKCdCZWFyZXIgJywgJycpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCF0b2tlbiAmJiByZXEuY29va2llcy50b2tlbikge1xyXG4gICAgICAgIHRva2VuID0gcmVxLmNvb2tpZXMudG9rZW47XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCdBdXRoIG1pZGRsZXdhcmUgLSBUb2tlbiBwcmVzZW50OicsICEhdG9rZW4pO1xyXG4gICAgICBjb25zb2xlLmxvZygnQXV0aCBtaWRkbGV3YXJlIC0gSGVhZGVyczonLCByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uID8gJ0F1dGhvcml6YXRpb24gaGVhZGVyIHByZXNlbnQnIDogJ05vIGF1dGhvcml6YXRpb24gaGVhZGVyJyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdBdXRoIG1pZGRsZXdhcmUgLSBDb29raWVzOicsIHJlcS5jb29raWVzLnRva2VuID8gJ1Rva2VuIGNvb2tpZSBwcmVzZW50JyA6ICdObyB0b2tlbiBjb29raWUnKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnQXV0aCBtaWRkbGV3YXJlIC0gTm8gdG9rZW4gcHJvdmlkZWQnKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ05vIHRva2VuIHByb3ZpZGVkJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJGcm9tVG9rZW4odG9rZW4pO1xyXG4gICAgICBcclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0F1dGggbWlkZGxld2FyZSAtIEludmFsaWQgdG9rZW4nKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgdG9rZW4nIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygnQXV0aCBtaWRkbGV3YXJlIC0gVXNlciBhdXRoZW50aWNhdGVkOicsIHVzZXIuZW1haWwsIHVzZXIucm9sZSk7XHJcbiAgICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzLCB1c2VyKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGggbWlkZGxld2FyZSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn1cclxuXHJcbi8vIE1pZGRsZXdhcmUgdG8gcHJvdGVjdCBBUEkgcm91dGVzIHdpdGggcm9sZSBjaGVja1xyXG5leHBvcnQgZnVuY3Rpb24gd2l0aEF1dGhBbmRSb2xlKHJvbGVzOiBVc2VyUm9sZVtdLCBoYW5kbGVyOiAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UsIHVzZXI6IEF1dGhVc2VyKSA9PiBQcm9taXNlPHZvaWQ+KSB7XHJcbiAgcmV0dXJuIHdpdGhBdXRoKGFzeW5jIChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSwgdXNlcjogQXV0aFVzZXIpID0+IHtcclxuICAgIGlmICghcm9sZXMuaW5jbHVkZXModXNlci5yb2xlKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzLCB1c2VyKTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gR2V0IHVzZXIgZnJvbSByZXF1ZXN0IChmb3IgcGFnZXMpXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyRnJvbVJlcXVlc3QocmVxOiBOZXh0QXBpUmVxdWVzdCk6IFByb21pc2U8QXV0aFVzZXIgfCBudWxsPiB7XHJcbiAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5yZXBsYWNlKCdCZWFyZXIgJywgJycpIHx8IFxyXG4gICAgICAgICAgICAgICAgcmVxLmNvb2tpZXMudG9rZW47XHJcbiAgXHJcbiAgaWYgKCF0b2tlbikgcmV0dXJuIG51bGw7XHJcbiAgXHJcbiAgcmV0dXJuIGdldFVzZXJGcm9tVG9rZW4odG9rZW4pO1xyXG59XHJcblxyXG4vLyBWZXJpZnkgYXV0aCBmb3IgQVBJIHJvdXRlcyB3aXRoIHByb3BlciByZXN1bHQgZm9ybWF0XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlBdXRoKHJlcTogTmV4dEFwaVJlcXVlc3QpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgdXNlcj86IEF1dGhVc2VyOyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlUb2tlbihyZXEpO1xyXG4gICAgaWYgKHVzZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXNlciB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gZmFpbGVkJyB9O1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdBdXRoIHZlcmlmaWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicgfTtcclxuICB9XHJcbn0iXSwibmFtZXMiOlsicHJpc21hIiwiand0IiwiYmNyeXB0IiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJoYXNoUGFzc3dvcmQiLCJwYXNzd29yZCIsImhhc2giLCJ2ZXJpZnlQYXNzd29yZCIsImhhc2hlZFBhc3N3b3JkIiwiY29tcGFyZSIsImdlbmVyYXRlVG9rZW4iLCJ1c2VyIiwic2lnbiIsImV4cGlyZXNJbiIsInZlcmlmeVRva2VuU3RyaW5nIiwidG9rZW4iLCJkZWNvZGVkIiwidmVyaWZ5IiwidXNlcklkIiwiaWQiLCJlbWFpbCIsIm5hbWUiLCJyb2xlIiwiaWF0IiwiZXhwIiwiZXJyb3IiLCJjb25zb2xlIiwiZ2V0VXNlckZyb21Ub2tlbiIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsInNlbGVjdCIsInZlcmlmeVRva2VuIiwicmVxIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJyZXBsYWNlIiwiY29va2llcyIsIndpdGhBdXRoIiwiaGFuZGxlciIsInJlcyIsImxvZyIsInN0YXR1cyIsImpzb24iLCJ3aXRoQXV0aEFuZFJvbGUiLCJyb2xlcyIsImluY2x1ZGVzIiwiZ2V0VXNlckZyb21SZXF1ZXN0IiwidmVyaWZ5QXV0aCIsInN1Y2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/auth.ts\n')},"(api)/./src/lib/prisma.ts":(module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client_edge__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client/edge */ "@prisma/client/edge");\n/* harmony import */ var _prisma_client_edge__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client_edge__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _prisma_extension_accelerate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @prisma/extension-accelerate */ "@prisma/extension-accelerate");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_prisma_extension_accelerate__WEBPACK_IMPORTED_MODULE_1__]);\n_prisma_extension_accelerate__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client_edge__WEBPACK_IMPORTED_MODULE_0__.PrismaClient().$extends((0,_prisma_extension_accelerate__WEBPACK_IMPORTED_MODULE_1__.withAccelerate)());\nif (true) globalForPrisma.prisma = prisma;\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQWtEO0FBQ1c7QUFFN0QsTUFBTUUsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSiw2REFBWUEsR0FBR0ssUUFBUSxDQUFDSiw0RUFBY0EsSUFBRztBQUU3RixJQUFJSyxJQUF5QixFQUFjSixnQkFBZ0JFLE1BQU0sR0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXh0LXBhZ2VzLWNoYWtyYS8uL3NyYy9saWIvcHJpc21hLnRzPzAxZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQvZWRnZSdcclxuaW1wb3J0IHsgd2l0aEFjY2VsZXJhdGUgfSBmcm9tICdAcHJpc21hL2V4dGVuc2lvbi1hY2NlbGVyYXRlJ1xyXG5cclxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcclxuICBwcmlzbWE6IFByaXNtYUNsaWVudCB8IHVuZGVmaW5lZFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcHJpc21hID0gZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA/PyBuZXcgUHJpc21hQ2xpZW50KCkuJGV4dGVuZHMod2l0aEFjY2VsZXJhdGUoKSlcclxuXHJcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsIndpdGhBY2NlbGVyYXRlIiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsInByaXNtYSIsIiRleHRlbmRzIiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/prisma.ts\n')},"(api)/./src/pages/api/brand/dashboard-stats.ts":(module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ "(api)/./src/lib/prisma.ts");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ "(api)/./src/lib/auth.ts");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_prisma__WEBPACK_IMPORTED_MODULE_0__, _lib_auth__WEBPACK_IMPORTED_MODULE_1__]);\n([_lib_prisma__WEBPACK_IMPORTED_MODULE_0__, _lib_auth__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\nasync function handler(req, res) {\n    if (req.method !== "GET") {\n        return res.status(405).json({\n            error: "Method not allowed"\n        });\n    }\n    try {\n        // Verify authentication with enhanced error handling\n        const user = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(req);\n        if (!user) {\n            console.log("Dashboard stats - No user found from token verification");\n            return res.status(401).json({\n                error: "Unauthorized - Please login again"\n            });\n        }\n        if (user.role !== "BRAND") {\n            console.log("Dashboard stats - User role mismatch:", user.role);\n            return res.status(403).json({\n                error: "Access denied. Brand role required."\n            });\n        }\n        console.log("Dashboard stats - Authenticated user:", user.id, user.email, user.role);\n        // Use user ID as brand ID for now\n        const brandId = user.id;\n        // Get current date for monthly calculations\n        const now = new Date();\n        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n        const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n        // Fetch dashboard statistics with real data\n        const [totalParts, activeShipments, authorizedServiceCenters, authorizedDistributors, walletBalance, pendingReturns, monthlyRevenue, recentShipments, lowStockParts, totalRevenue, totalWalletTransactions, deliveredShipments] = await Promise.all([\n            // Total Parts in catalog\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.part.count({\n                where: {\n                    brandId: brandId\n                }\n            }),\n            // Active Shipments (in-transit)\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.shipment.count({\n                where: {\n                    brandId: brandId,\n                    status: {\n                        in: [\n                            "INITIATED",\n                            "DISPATCHED"\n                        ]\n                    }\n                }\n            }),\n            // Authorized Service Centers\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.brandAuthorizedServiceCenter.count({\n                where: {\n                    brandId: brandId,\n                    status: "Active"\n                }\n            }),\n            // Authorized Distributors\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.brandAuthorizedDistributor.count({\n                where: {\n                    brandId: brandId,\n                    status: "Active"\n                }\n            }),\n            // Wallet Balance\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.wallet.findUnique({\n                where: {\n                    userId: user.id\n                },\n                select: {\n                    balance: true\n                }\n            }),\n            // Pending Returns\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.returnRequest.count({\n                where: {\n                    part: {\n                        brandId: brandId\n                    },\n                    status: "REQUESTED"\n                }\n            }),\n            // Monthly Revenue from wallet transactions\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.walletTransaction.aggregate({\n                where: {\n                    userId: brandId,\n                    type: "DEBIT",\n                    createdAt: {\n                        gte: startOfMonth,\n                        lte: endOfMonth\n                    }\n                },\n                _sum: {\n                    amount: true\n                }\n            }),\n            // Recent Shipments (last 5)\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.shipment.findMany({\n                where: {\n                    brandId: brandId\n                },\n                orderBy: {\n                    createdAt: "desc"\n                },\n                take: 5,\n                select: {\n                    id: true,\n                    status: true,\n                    createdAt: true,\n                    serviceCenter: {\n                        select: {\n                            name: true\n                        }\n                    }\n                }\n            }),\n            // Low Stock Parts - get all parts and filter in memory for field comparison\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.part.findMany({\n                where: {\n                    brandId: brandId,\n                    stockQuantity: {\n                        lte: 5\n                    } // Low stock threshold\n                },\n                select: {\n                    id: true,\n                    name: true,\n                    partNumber: true,\n                    stockQuantity: true,\n                    minStockLevel: true\n                },\n                take: 5\n            }),\n            // Total Revenue (all time)\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.walletTransaction.aggregate({\n                where: {\n                    userId: brandId,\n                    type: "DEBIT"\n                },\n                _sum: {\n                    amount: true\n                }\n            }),\n            // Total wallet transactions for metrics\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.walletTransaction.count({\n                where: {\n                    userId: brandId\n                }\n            }),\n            // Delivered shipments for success rate\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.shipment.count({\n                where: {\n                    brandId: brandId,\n                    status: "DELIVERED"\n                }\n            })\n        ]);\n        // Calculate additional metrics\n        const totalAuthorizedPartners = authorizedServiceCenters + authorizedDistributors;\n        const currentWalletBalance = walletBalance?.balance || 0;\n        const currentMonthlyRevenue = monthlyRevenue._sum.amount || 0;\n        const currentTotalRevenue = totalRevenue._sum.amount || 0;\n        // Debug logging\n        console.log("Dashboard stats debug:", {\n            brandId,\n            totalParts,\n            activeShipments,\n            authorizedServiceCenters,\n            authorizedDistributors,\n            currentWalletBalance,\n            pendingReturns,\n            lowStockPartsCount: lowStockParts.length,\n            currentMonthlyRevenue,\n            currentTotalRevenue\n        });\n        // Get shipment trends (last 7 days) with real data\n        const last7Days = new Date();\n        last7Days.setDate(last7Days.getDate() - 7);\n        const shipmentTrends = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.shipment.groupBy({\n            by: [\n                "createdAt"\n            ],\n            where: {\n                brandId: brandId,\n                createdAt: {\n                    gte: last7Days\n                }\n            },\n            _count: {\n                id: true\n            }\n        });\n        // Get return trends with real data\n        const returnTrends = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.returnRequest.groupBy({\n            by: [\n                "status"\n            ],\n            where: {\n                part: {\n                    brandId: brandId\n                }\n            },\n            _count: {\n                id: true\n            }\n        });\n        // Get top performing parts (by shipment frequency) with real data\n        const topParts = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.boxPart.groupBy({\n            by: [\n                "partId"\n            ],\n            where: {\n                box: {\n                    shipment: {\n                        brandId: brandId,\n                        status: "DELIVERED"\n                    }\n                }\n            },\n            _count: {\n                partId: true\n            },\n            orderBy: {\n                _count: {\n                    partId: "desc"\n                }\n            },\n            take: 5\n        });\n        // Get part details for top performing parts\n        const topPartDetails = await Promise.all(topParts.map(async (item)=>{\n            const part = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.part.findUnique({\n                where: {\n                    id: item.partId\n                },\n                select: {\n                    id: true,\n                    name: true,\n                    partNumber: true,\n                    price: true\n                }\n            });\n            return {\n                ...part,\n                partName: part?.name,\n                shipmentCount: item._count.partId\n            };\n        }));\n        // Calculate performance metrics\n        const totalShipments = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.shipment.count({\n            where: {\n                brandId: brandId\n            }\n        });\n        const shipmentSuccessRate = totalShipments > 0 ? deliveredShipments / totalShipments * 100 : 0;\n        const returnRate = totalShipments > 0 ? pendingReturns / totalShipments * 100 : 0;\n        // Get recent notifications (mock for now as we don\'t have a notification system implemented)\n        const recentNotifications = [];\n        const dashboardStats = {\n            metrics: {\n                totalParts,\n                activeShipments,\n                authorizedPartners: totalAuthorizedPartners,\n                walletBalance: currentWalletBalance,\n                pendingReturns,\n                monthlyRevenue: currentMonthlyRevenue,\n                totalRevenue: currentTotalRevenue,\n                shipmentSuccessRate: Math.round(shipmentSuccessRate * 10) / 10,\n                returnRate: Math.round(returnRate * 10) / 10\n            },\n            breakdown: {\n                authorizedServiceCenters,\n                authorizedDistributors\n            },\n            recentActivity: {\n                shipments: recentShipments,\n                notifications: recentNotifications\n            },\n            alerts: {\n                lowStockParts\n            },\n            trends: {\n                shipments: shipmentTrends,\n                returns: returnTrends\n            },\n            topPerformers: {\n                parts: topPartDetails\n            },\n            summary: {\n                totalTransactions: totalWalletTransactions,\n                averageOrderValue: totalWalletTransactions > 0 ? Math.round(currentTotalRevenue / totalWalletTransactions) : 0,\n                growthRate: 0 // Would need historical data to calculate\n            }\n        };\n        res.status(200).json(dashboardStats);\n    } catch (error) {\n        console.error("Brand dashboard stats error:", error);\n        res.status(500).json({\n            error: "Failed to fetch dashboard statistics",\n            details: error instanceof Error ? error.message : "Unknown error"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2JyYW5kL2Rhc2hib2FyZC1zdGF0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFDc0M7QUFDRztBQUUxQixlQUFlRSxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSxJQUFJRCxJQUFJRSxNQUFNLEtBQUssT0FBTztRQUN4QixPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBcUI7SUFDNUQ7SUFFQSxJQUFJO1FBQ0YscURBQXFEO1FBQ3JELE1BQU1DLE9BQU8sTUFBTVIsc0RBQVdBLENBQUNFO1FBQy9CLElBQUksQ0FBQ00sTUFBTTtZQUNUQyxRQUFRQyxHQUFHLENBQUM7WUFDWixPQUFPUCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQW9DO1FBQzNFO1FBRUEsSUFBSUMsS0FBS0csSUFBSSxLQUFLLFNBQVM7WUFDekJGLFFBQVFDLEdBQUcsQ0FBQyx5Q0FBeUNGLEtBQUtHLElBQUk7WUFDOUQsT0FBT1IsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFzQztRQUM3RTtRQUVBRSxRQUFRQyxHQUFHLENBQUMseUNBQXlDRixLQUFLSSxFQUFFLEVBQUVKLEtBQUtLLEtBQUssRUFBRUwsS0FBS0csSUFBSTtRQUVuRixrQ0FBa0M7UUFDbEMsTUFBTUcsVUFBVU4sS0FBS0ksRUFBRTtRQUV2Qiw0Q0FBNEM7UUFDNUMsTUFBTUcsTUFBTSxJQUFJQztRQUNoQixNQUFNQyxlQUFlLElBQUlELEtBQUtELElBQUlHLFdBQVcsSUFBSUgsSUFBSUksUUFBUSxJQUFJO1FBQ2pFLE1BQU1DLGFBQWEsSUFBSUosS0FBS0QsSUFBSUcsV0FBVyxJQUFJSCxJQUFJSSxRQUFRLEtBQUssR0FBRztRQUVuRSw0Q0FBNEM7UUFDNUMsTUFBTSxDQUNKRSxZQUNBQyxpQkFDQUMsMEJBQ0FDLHdCQUNBQyxlQUNBQyxnQkFDQUMs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QUNOLGFBQWEsTUFBTTtZQUM1QztZQUNBTyxXQUFXO2dCQUNUMUU7Z0JBQ0FDO1lBQ0Y7WUFDQTBFLGdCQUFnQjtnQkFDZEMsV0FBV3ZFO2dCQUNYd0UsZUFBZVQ7WUFDakI7WUFDQVUsUUFBUTtnQkFDTnhFO1lBQ0Y7WUFDQXlFLFFBQVE7Z0JBQ05ILFdBQVcxQjtnQkFDWDhCLFNBQVMxQjtZQUNYO1lBQ0EyQixlQUFlO2dCQUNiQyxPQUFPdkI7WUFDVDtZQUNBd0IsU0FBUztnQkFDUEMsbUJBQW1CNUU7Z0JBQ25CNkUsbUJBQW1CN0UsMEJBQTBCLElBQUlnRSxLQUFLQyxLQUFLLENBQUM3QixzQkFBc0JwQywyQkFBMkI7Z0JBQzdHOEUsWUFBWSxFQUFFLDBDQUEwQztZQUMxRDtRQUNGO1FBRUExRyxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDc0Y7SUFFdkIsRUFBRSxPQUFPckYsT0FBTztRQUNkRSxRQUFRRixLQUFLLENBQUMsZ0NBQWdDQTtRQUM5Q0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUNuQkMsT0FBTztZQUNQdUcsU0FBU3ZHLGlCQUFpQndHLFFBQVF4RyxNQUFNeUcsT0FBTyxHQUFHO1FBQ3BEO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25leHQtcGFnZXMtY2hha3JhLy4vc3JjL3BhZ2VzL2FwaS9icmFuZC9kYXNoYm9hcmQtc3RhdHMudHM/OTFjYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XHJcbmltcG9ydCB7IHZlcmlmeVRva2VuIH0gZnJvbSAnQC9saWIvYXV0aCc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdHRVQnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgLy8gVmVyaWZ5IGF1dGhlbnRpY2F0aW9uIHdpdGggZW5oYW5jZWQgZXJyb3IgaGFuZGxpbmdcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlUb2tlbihyZXEpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdEYXNoYm9hcmQgc3RhdHMgLSBObyB1c2VyIGZvdW5kIGZyb20gdG9rZW4gdmVyaWZpY2F0aW9uJyk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkIC0gUGxlYXNlIGxvZ2luIGFnYWluJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodXNlci5yb2xlICE9PSAnQlJBTkQnKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdEYXNoYm9hcmQgc3RhdHMgLSBVc2VyIHJvbGUgbWlzbWF0Y2g6JywgdXNlci5yb2xlKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkLiBCcmFuZCByb2xlIHJlcXVpcmVkLicgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0Rhc2hib2FyZCBzdGF0cyAtIEF1dGhlbnRpY2F0ZWQgdXNlcjonLCB1c2VyLmlkLCB1c2VyLmVtYWlsLCB1c2VyLnJvbGUpO1xyXG5cclxuICAgIC8vIFVzZSB1c2VyIElEIGFzIGJyYW5kIElEIGZvciBub3dcclxuICAgIGNvbnN0IGJyYW5kSWQgPSB1c2VyLmlkO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGRhdGUgZm9yIG1vbnRobHkgY2FsY3VsYXRpb25zXHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3Qgc3RhcnRPZk1vbnRoID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpLCAxKTtcclxuICAgIGNvbnN0IGVuZE9mTW9udGggPSBuZXcgRGF0ZShub3cuZ2V0RnVsbFllYXIoKSwgbm93LmdldE1vbnRoKCkgKyAxLCAwKTtcclxuXHJcbiAgICAvLyBGZXRjaCBkYXNoYm9hcmQgc3RhdGlzdGljcyB3aXRoIHJlYWwgZGF0YVxyXG4gICAgY29uc3QgW1xyXG4gICAgICB0b3RhbFBhcnRzLFxyXG4gICAgICBhY3RpdmVTaGlwbWVudHMsXHJcbiAgICAgIGF1dGhvcml6ZWRTZXJ2aWNlQ2VudGVycyxcclxuICAgICAgYXV0aG9yaXplZERpc3RyaWJ1dG9ycyxcclxuICAgICAgd2FsbGV0QmFsYW5jZSxcclxuICAgICAgcGVuZGluZ1JldHVybnMsXHJcbiAgICAgIG1vbnRobHlSZXZlbnVlLFxyXG4gICAgICByZWNlbnRTaGlwbWVudHMsXHJcbiAgICAgIGxvd1N0b2NrUGFydHMsXHJcbiAgICAgIHRvdGFsUmV2ZW51ZSxcclxuICAgICAgdG90YWxXYWxsZXRUcmFuc2FjdGlvbnMsXHJcbiAgICAgIGRlbGl2ZXJlZFNoaXBtZW50c1xyXG4gICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgLy8gVG90YWwgUGFydHMgaW4gY2F0YWxvZ1xyXG4gICAgICBwcmlzbWEucGFydC5jb3VudCh7XHJcbiAgICAgICAgd2hlcmU6IHsgYnJhbmRJZDogYnJhbmRJZCB9XHJcbiAgICAgIH0pLFxyXG5cclxuICAgICAgLy8gQWN0aXZlIFNoaXBtZW50cyAoaW4tdHJhbnNpdClcclxuICAgICAgcHJpc21hLnNoaXBtZW50LmNvdW50KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgYnJhbmRJZDogYnJhbmRJZCxcclxuICAgICAgICAgIHN0YXR1czoge1xyXG4gICAgICAgICAgICBpbjogWydJTklUSUFURUQnLCAnRElTUEFUQ0hFRCddXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuXHJcbiAgICAgIC8vIEF1dGhvcml6ZWQgU2VydmljZSBDZW50ZXJzXHJcbiAgICAgIHByaXNtYS5icmFuZEF1dGhvcml6ZWRTZXJ2aWNlQ2VudGVyLmNvdW50KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgYnJhbmRJZDogYnJhbmRJZCxcclxuICAgICAgICAgIHN0YXR1czogJ0FjdGl2ZSdcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG5cclxuICAgICAgLy8gQXV0aG9yaXplZCBEaXN0cmlidXRvcnNcclxuICAgICAgcHJpc21hLmJyYW5kQXV0aG9yaXplZERpc3RyaWJ1dG9yLmNvdW50KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgYnJhbmRJZDogYnJhbmRJZCxcclxuICAgICAgICAgIHN0YXR1czogJ0FjdGl2ZSdcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG5cclxuICAgICAgLy8gV2FsbGV0IEJhbGFuY2VcclxuICAgICAgcHJpc21hLndhbGxldC5maW5kVW5pcXVlKHtcclxuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHVzZXIuaWQgfSxcclxuICAgICAgICBzZWxlY3Q6IHsgYmFsYW5jZTogdHJ1ZSB9XHJcbiAgICAgIH0pLFxyXG5cclxuICAgICAgLy8gUGVuZGluZyBSZXR1cm5zXHJcbiAgICAgIHByaXNtYS5yZXR1cm5SZXF1ZXN0LmNvdW50KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgcGFydDoge1xyXG4gICAgICAgICAgICBicmFuZElkOiBicmFuZElkXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc3RhdHVzOiAnUkVRVUVTVEVEJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcblxyXG4gICAgICAvLyBNb250aGx5IFJldmVudWUgZnJvbSB3YWxsZXQgdHJhbnNhY3Rpb25zXHJcbiAgICAgIHByaXNtYS53YWxsZXRUcmFuc2FjdGlvbi5hZ2dyZWdhdGUoe1xyXG4gICAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgICB1c2VySWQ6IGJyYW5kSWQsXHJcbiAgICAgICAgICB0eXBlOiAnREVCSVQnLFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiB7XHJcbiAgICAgICAgICAgIGd0ZTogc3RhcnRPZk1vbnRoLFxyXG4gICAgICAgICAgICBsdGU6IGVuZE9mTW9udGhcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIF9zdW06IHsgYW1vdW50OiB0cnVlIH1cclxuICAgICAgfSksXHJcblxyXG4gICAgICAvLyBSZWNlbnQgU2hpcG1lbnRzIChsYXN0IDUpXHJcbiAgICAgIHByaXNtYS5zaGlwbWVudC5maW5kTWFueSh7XHJcbiAgICAgICAgd2hlcmU6IHsgYnJhbmRJZDogYnJhbmRJZCB9LFxyXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcclxuICAgICAgICB0YWtlOiA1LFxyXG4gICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgICBzdGF0dXM6IHRydWUsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXHJcbiAgICAgICAgICBzZXJ2aWNlQ2VudGVyOiB7XHJcbiAgICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICAgIG5hbWU6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcblxyXG4gICAgICAvLyBMb3cgU3RvY2sgUGFydHMgLSBnZXQgYWxsIHBhcnRzIGFuZCBmaWx0ZXIgaW4gbWVtb3J5IGZvciBmaWVsZCBjb21wYXJpc29uXHJcbiAgICAgIHByaXNtYS5wYXJ0LmZpbmRNYW55KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgYnJhbmRJZDogYnJhbmRJZCxcclxuICAgICAgICAgIHN0b2NrUXVhbnRpdHk6IHsgbHRlOiA1IH0gLy8gTG93IHN0b2NrIHRocmVzaG9sZFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICBpZDogdHJ1ZSxcclxuICAgICAgICAgIG5hbWU6IHRydWUsXHJcbiAgICAgICAgICBwYXJ0TnVtYmVyOiB0cnVlLFxyXG4gICAgICAgICAgc3RvY2tRdWFudGl0eTogdHJ1ZSxcclxuICAgICAgICAgIG1pblN0b2NrTGV2ZWw6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRha2U6IDVcclxuICAgICAgfSksXHJcblxyXG4gICAgICAvLyBUb3RhbCBSZXZlbnVlIChhbGwgdGltZSlcclxuICAgICAgcHJpc21hLndhbGxldFRyYW5zYWN0aW9uLmFnZ3JlZ2F0ZSh7XHJcbiAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgIHVzZXJJZDogYnJhbmRJZCxcclxuICAgICAgICAgIHR5cGU6ICdERUJJVCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIF9zdW06IHsgYW1vdW50OiB0cnVlIH1cclxuICAgICAgfSksXHJcblxyXG4gICAgICAvLyBUb3RhbCB3YWxsZXQgdHJhbnNhY3Rpb25zIGZvciBtZXRyaWNzXHJcbiAgICAgIHByaXNtYS53YWxsZXRUcmFuc2FjdGlvbi5jb3VudCh7XHJcbiAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgIHVzZXJJZDogYnJhbmRJZFxyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcblxyXG4gICAgICAvLyBEZWxpdmVyZWQgc2hpcG1lbnRzIGZvciBzdWNjZXNzIHJhdGVcclxuICAgICAgcHJpc21hLnNoaXBtZW50LmNvdW50KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgYnJhbmRJZDogYnJhbmRJZCxcclxuICAgICAgICAgIHN0YXR1czogJ0RFTElWRVJFRCdcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICBdKTtcclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgYWRkaXRpb25hbCBtZXRyaWNzXHJcbiAgICBjb25zdCB0b3RhbEF1dGhvcml6ZWRQYXJ0bmVycyA9IGF1dGhvcml6ZWRTZXJ2aWNlQ2VudGVycyArIGF1dGhvcml6ZWREaXN0cmlidXRvcnM7XHJcbiAgICBjb25zdCBjdXJyZW50V2FsbGV0QmFsYW5jZSA9IHdhbGxldEJhbGFuY2U/LmJhbGFuY2UgfHwgMDtcclxuICAgIGNvbnN0IGN1cnJlbnRNb250aGx5UmV2ZW51ZSA9IG1vbnRobHlSZXZlbnVlLl9zdW0uYW1vdW50IHx8IDA7XHJcbiAgICBjb25zdCBjdXJyZW50VG90YWxSZXZlbnVlID0gdG90YWxSZXZlbnVlLl9zdW0uYW1vdW50IHx8IDA7XHJcblxyXG4gICAgLy8gRGVidWcgbG9nZ2luZ1xyXG4gICAgY29uc29sZS5sb2coJ0Rhc2hib2FyZCBzdGF0cyBkZWJ1ZzonLCB7XHJcbiAgICAgIGJyYW5kSWQsXHJcbiAgICAgIHRvdGFsUGFydHMsXHJcbiAgICAgIGFjdGl2ZVNoaXBtZW50cyxcclxuICAgICAgYXV0aG9yaXplZFNlcnZpY2VDZW50ZXJzLFxyXG4gICAgICBhdXRob3JpemVkRGlzdHJpYnV0b3JzLFxyXG4gICAgICBjdXJyZW50V2FsbGV0QmFsYW5jZSxcclxuICAgICAgcGVuZGluZ1JldHVybnMsXHJcbiAgICAgIGxvd1N0b2NrUGFydHNDb3VudDogbG93U3RvY2tQYXJ0cy5sZW5ndGgsXHJcbiAgICAgIGN1cnJlbnRNb250aGx5UmV2ZW51ZSxcclxuICAgICAgY3VycmVudFRvdGFsUmV2ZW51ZVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gR2V0IHNoaXBtZW50IHRyZW5kcyAobGFzdCA3IGRheXMpIHdpdGggcmVhbCBkYXRhXHJcbiAgICBjb25zdCBsYXN0N0RheXMgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbGFzdDdEYXlzLnNldERhdGUobGFzdDdEYXlzLmdldERhdGUoKSAtIDcpO1xyXG5cclxuICAgIGNvbnN0IHNoaXBtZW50VHJlbmRzID0gYXdhaXQgcHJpc21hLnNoaXBtZW50Lmdyb3VwQnkoe1xyXG4gICAgICBieTogWydjcmVhdGVkQXQnXSxcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBicmFuZElkOiBicmFuZElkLFxyXG4gICAgICAgIGNyZWF0ZWRBdDoge1xyXG4gICAgICAgICAgZ3RlOiBsYXN0N0RheXNcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIF9jb3VudDoge1xyXG4gICAgICAgIGlkOiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEdldCByZXR1cm4gdHJlbmRzIHdpdGggcmVhbCBkYXRhXHJcbiAgICBjb25zdCByZXR1cm5UcmVuZHMgPSBhd2FpdCBwcmlzbWEucmV0dXJuUmVxdWVzdC5ncm91cEJ5KHtcclxuICAgICAgYnk6IFsnc3RhdHVzJ10sXHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgcGFydDoge1xyXG4gICAgICAgICAgYnJhbmRJZDogYnJhbmRJZFxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgX2NvdW50OiB7XHJcbiAgICAgICAgaWQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gR2V0IHRvcCBwZXJmb3JtaW5nIHBhcnRzIChieSBzaGlwbWVudCBmcmVxdWVuY3kpIHdpdGggcmVhbCBkYXRhXHJcbiAgICBjb25zdCB0b3BQYXJ0cyA9IGF3YWl0IHByaXNtYS5ib3hQYXJ0Lmdyb3VwQnkoe1xyXG4gICAgICBieTogWydwYXJ0SWQnXSxcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBib3g6IHtcclxuICAgICAgICAgIHNoaXBtZW50OiB7XHJcbiAgICAgICAgICAgIGJyYW5kSWQ6IGJyYW5kSWQsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ0RFTElWRVJFRCdcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIF9jb3VudDoge1xyXG4gICAgICAgIHBhcnRJZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICBvcmRlckJ5OiB7XHJcbiAgICAgICAgX2NvdW50OiB7XHJcbiAgICAgICAgICBwYXJ0SWQ6ICdkZXNjJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgdGFrZTogNVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gR2V0IHBhcnQgZGV0YWlscyBmb3IgdG9wIHBlcmZvcm1pbmcgcGFydHNcclxuICAgIGNvbnN0IHRvcFBhcnREZXRhaWxzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgIHRvcFBhcnRzLm1hcChhc3luYyAoaXRlbSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBhcnQgPSBhd2FpdCBwcmlzbWEucGFydC5maW5kVW5pcXVlKHtcclxuICAgICAgICAgIHdoZXJlOiB7IGlkOiBpdGVtLnBhcnRJZCB9LFxyXG4gICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgIGlkOiB0cnVlLFxyXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICBwYXJ0TnVtYmVyOiB0cnVlLFxyXG4gICAgICAgICAgICBwcmljZTogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAuLi5wYXJ0LFxyXG4gICAgICAgICAgcGFydE5hbWU6IHBhcnQ/Lm5hbWUsXHJcbiAgICAgICAgICBzaGlwbWVudENvdW50OiBpdGVtLl9jb3VudC5wYXJ0SWRcclxuICAgICAgICB9O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgcGVyZm9ybWFuY2UgbWV0cmljc1xyXG4gICAgY29uc3QgdG90YWxTaGlwbWVudHMgPSBhd2FpdCBwcmlzbWEuc2hpcG1lbnQuY291bnQoe1xyXG4gICAgICB3aGVyZTogeyBicmFuZElkOiBicmFuZElkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNoaXBtZW50U3VjY2Vzc1JhdGUgPSB0b3RhbFNoaXBtZW50cyA+IDAgPyAoZGVsaXZlcmVkU2hpcG1lbnRzIC8gdG90YWxTaGlwbWVudHMpICogMTAwIDogMDtcclxuICAgIGNvbnN0IHJldHVyblJhdGUgPSB0b3RhbFNoaXBtZW50cyA+IDAgPyAocGVuZGluZ1JldHVybnMgLyB0b3RhbFNoaXBtZW50cykgKiAxMDAgOiAwO1xyXG5cclxuICAgIC8vIEdldCByZWNlbnQgbm90aWZpY2F0aW9ucyAobW9jayBmb3Igbm93IGFzIHdlIGRvbid0IGhhdmUgYSBub3RpZmljYXRpb24gc3lzdGVtIGltcGxlbWVudGVkKVxyXG4gICAgY29uc3QgcmVjZW50Tm90aWZpY2F0aW9ucyA9IFtdO1xyXG5cclxuICAgIGNvbnN0IGRhc2hib2FyZFN0YXRzID0ge1xyXG4gICAgICBtZXRyaWNzOiB7XHJcbiAgICAgICAgdG90YWxQYXJ0cyxcclxuICAgICAgICBhY3RpdmVTaGlwbWVudHMsXHJcbiAgICAgICAgYXV0aG9yaXplZFBhcnRuZXJzOiB0b3RhbEF1dGhvcml6ZWRQYXJ0bmVycyxcclxuICAgICAgICB3YWxsZXRCYWxhbmNlOiBjdXJyZW50V2FsbGV0QmFsYW5jZSxcclxuICAgICAgICBwZW5kaW5nUmV0dXJucyxcclxuICAgICAgICBtb250aGx5UmV2ZW51ZTogY3VycmVudE1vbnRobHlSZXZlbnVlLFxyXG4gICAgICAgIHRvdGFsUmV2ZW51ZTogY3VycmVudFRvdGFsUmV2ZW51ZSxcclxuICAgICAgICBzaGlwbWVudFN1Y2Nlc3NSYXRlOiBNYXRoLnJvdW5kKHNoaXBtZW50U3VjY2Vzc1JhdGUgKiAxMCkgLyAxMCxcclxuICAgICAgICByZXR1cm5SYXRlOiBNYXRoLnJvdW5kKHJldHVyblJhdGUgKiAxMCkgLyAxMFxyXG4gICAgICB9LFxyXG4gICAgICBicmVha2Rvd246IHtcclxuICAgICAgICBhdXRob3JpemVkU2VydmljZUNlbnRlcnMsXHJcbiAgICAgICAgYXV0aG9yaXplZERpc3RyaWJ1dG9yc1xyXG4gICAgICB9LFxyXG4gICAgICByZWNlbnRBY3Rpdml0eToge1xyXG4gICAgICAgIHNoaXBtZW50czogcmVjZW50U2hpcG1lbnRzLFxyXG4gICAgICAgIG5vdGlmaWNhdGlvbnM6IHJlY2VudE5vdGlmaWNhdGlvbnNcclxuICAgICAgfSxcclxuICAgICAgYWxlcnRzOiB7XHJcbiAgICAgICAgbG93U3RvY2tQYXJ0c1xyXG4gICAgICB9LFxyXG4gICAgICB0cmVuZHM6IHtcclxuICAgICAgICBzaGlwbWVudHM6IHNoaXBtZW50VHJlbmRzLFxyXG4gICAgICAgIHJldHVybnM6IHJldHVyblRyZW5kc1xyXG4gICAgICB9LFxyXG4gICAgICB0b3BQZXJmb3JtZXJzOiB7XHJcbiAgICAgICAgcGFydHM6IHRvcFBhcnREZXRhaWxzXHJcbiAgICAgIH0sXHJcbiAgICAgIHN1bW1hcnk6IHtcclxuICAgICAgICB0b3RhbFRyYW5zYWN0aW9uczogdG90YWxXYWxsZXRUcmFuc2FjdGlvbnMsXHJcbiAgICAgICAgYXZlcmFnZU9yZGVyVmFsdWU6IHRvdGFsV2FsbGV0VHJhbnNhY3Rpb25zID4gMCA/IE1hdGgucm91bmQoY3VycmVudFRvdGFsUmV2ZW51ZSAvIHRvdGFsV2FsbGV0VHJhbnNhY3Rpb25zKSA6IDAsXHJcbiAgICAgICAgZ3Jvd3RoUmF0ZTogMCAvLyBXb3VsZCBuZWVkIGhpc3RvcmljYWwgZGF0YSB0byBjYWxjdWxhdGVcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihkYXNoYm9hcmRTdGF0cyk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdCcmFuZCBkYXNoYm9hcmQgc3RhdHMgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggZGFzaGJvYXJkIHN0YXRpc3RpY3MnLFxyXG4gICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbInByaXNtYSIsInZlcmlmeVRva2VuIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInVzZXIiLCJjb25zb2xlIiwibG9nIiwicm9sZSIsImlkIiwiZW1haWwiLCJicmFuZElkIiwibm93IiwiRGF0ZSIsInN0YXJ0T2ZNb250aCIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJlbmRPZk1vbnRoIiwidG90YWxQYXJ0cyIsImFjdGl2ZVNoaXBtZW50cyIsImF1dGhvcml6ZWRTZXJ2aWNlQ2VudGVycyIsImF1dGhvcml6ZWREaXN0cmlidXRvcnMiLCJ3YWxsZXRCYWxhbmNlIiwicGVuZGluZ1JldHVybnMiLCJtb250aGx5UmV2ZW51ZSIsInJlY2VudFNoaXBtZW50cyIsImxvd1N0b2NrUGFydHMiLCJ0b3RhbFJldmVudWUiLCJ0b3RhbFdhbGxldFRyYW5zYWN0aW9ucyIsImRlbGl2ZXJlZFNoaXBtZW50cyIsIlByb21pc2UiLCJhbGwiLCJwYXJ0IiwiY291bnQiLCJ3aGVyZSIsInNoaXBtZW50IiwiaW4iLCJicmFuZEF1dGhvcml6ZWRTZXJ2aWNlQ2VudGVyIiwiYnJhbmRBdXRob3JpemVkRGlzdHJpYnV0b3IiLCJ3YWxsZXQiLCJmaW5kVW5pcXVlIiwidXNlcklkIiwic2VsZWN0IiwiYmFsYW5jZSIsInJldHVyblJlcXVlc3QiLCJ3YWxsZXRUcmFuc2FjdGlvbiIsImFnZ3JlZ2F0ZSIsInR5cGUiLCJjcmVhdGVkQXQiLCJndGUiLCJsdGUiLCJfc3VtIiwiYW1vdW50IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidGFrZSIsInNlcnZpY2VDZW50ZXIiLCJuYW1lIiwic3RvY2tRdWFudGl0eSIsInBhcnROdW1iZXIiLCJtaW5TdG9ja0xldmVsIiwidG90YWxBdXRob3JpemVkUGFydG5lcnMiLCJjdXJyZW50V2FsbGV0QmFsYW5jZSIsImN1cnJlbnRNb250aGx5UmV2ZW51ZSIsImN1cnJlbnRUb3RhbFJldmVudWUiLCJsb3dTdG9ja1BhcnRzQ291bnQiLCJsZW5ndGgiLCJsYXN0N0RheXMiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInNoaXBtZW50VHJlbmRzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwicmV0dXJuVHJlbmRzIiwidG9wUGFydHMiLCJib3hQYXJ0IiwiYm94IiwicGFydElkIiwidG9wUGFydERldGFpbHMiLCJtYXAiLCJpdGVtIiwicHJpY2UiLCJwYXJ0TmFtZSIsInNoaXBtZW50Q291bnQiLCJ0b3RhbFNoaXBtZW50cyIsInNoaXBtZW50U3VjY2Vzc1JhdGUiLCJyZXR1cm5SYXRlIiwicmVjZW50Tm90aWZpY2F0aW9ucyIsImRhc2hib2FyZFN0YXRzIiwibWV0cmljcyIsImF1dGhvcml6ZWRQYXJ0bmVycyIsIk1hdGgiLCJyb3VuZCIsImJyZWFrZG93biIsInJlY2VudEFjdGl2aXR5Iiwic2hpcG1lbnRzIiwibm90aWZpY2F0aW9ucyIsImFsZXJ0cyIsInRyZW5kcyIsInJldHVybnMiLCJ0b3BQZXJmb3JtZXJzIiwicGFydHMiLCJzdW1tYXJ5IiwidG90YWxUcmFuc2FjdGlvbnMiLCJhdmVyYWdlT3JkZXJWYWx1ZSIsImdyb3d0aFJhdGUiLCJkZXRhaWxzIiwiRXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/brand/dashboard-stats.ts\n')}};var __webpack_require__=require("../../../webpack-api-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=n=>__webpack_require__(__webpack_require__.s=n),__webpack_exports__=__webpack_require__.X(0,["vendor-chunks/next"],()=>__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbrand%2Fdashboard-stats&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cbrand%5Cdashboard-stats.ts&middlewareConfigBase64=e30%3D!"));module.exports=__webpack_exports__})();